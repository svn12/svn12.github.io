<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>`PDF Show example
  </title>
</head>
<body>

<h1>PDF Show
  </h1>
<div>
  	<button id="prev">上一頁</button>
  	<button id="next">下一頁</button>
  	<span>頁數: <span id="page_num">1</span> / <span id="page_count"></span></span>
  </div>
  

<canvas id="the-canvas" style="border: 1px solid black; direction: ltr;"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.0.279/pdf.min.js"></script>

<script id="script">
  //
  // If absolute URL from the remote server is provided, configure the CORS
  // header on that server.
  //
  const url = '../doc/old-01.pdf';

  //https://www.sbchurch.org.tw/wp-content/uploads/old-2.pdf
  // The workerSrc property shall be specified.
  //
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.0.279/pdf.worker.min.js';

  //
  // Asynchronous download PDF
  //
const canvas = document.getElementById("the-canvas");
const outputScale = window.devicePixelRatio || 1;
const context = canvas.getContext("2d");
var pdfDoc = null,
  	pageNum = 1,
  	pageRendering = false,
  	pageNumPending = null,
	viewport =null,
	page=null,
  	scale = 1.5;
  	
  	ctx = canvas.getContext( "2d" );

  	function renderPage( num )
  	{
  		pageRendering = true;
  		pdfDoc.getPage( num )
		.then( function( page ) {
  		viewport = page.getViewport({ scale });
  		/*	canvas.height = viewport.height;
  			canvas.width = viewport.width;
  			var renderContext = {
  				canvasContext: ctx,
  				viewport: viewport
  			};
		*/	
			canvas.width = Math.floor(viewport.width * outputScale);
			canvas.height = Math.floor(viewport.height * outputScale);
			canvas.style.width = Math.floor(viewport.width) + "px";
			canvas.style.height = Math.floor(viewport.height) + "px";

			let transform = outputScale !== 1 
			  ? [outputScale, 0, 0, outputScale, 0, 0] 
			  : null;

			//
			// Render PDF page into canvas context
			//
			const renderContext = {
			  canvasContext: context,
			  transform,
			  viewport,
			};
  			var renderTask = page.render(renderContext);
  			renderTask.promise.then( function() {
  				pageRendering = false;
  				if ( pageNumPending !== null ) {
  					renderPage( pageNumPending );
  					pageNumPending = null;
  				}
  			});
  		});
  		document.getElementById( "page_num" ).textContent = num;
  	}

  	function queueRenderPage( num )
  	{
  		if ( pageRendering ) {
  			pageNumPending = num;
  		} else {
  			renderPage( num );
  		}
  	}

  	function onPrevPage()
  	{
  		// 上一頁
  		if ( pageNum <= 1 ) {
  			return;
  		}
  		pageNum--;
  		queueRenderPage( pageNum );
  	}
  	document.getElementById( "prev" ).addEventListener( "click", onPrevPage );

  	function onNextPage()
  	{
  		// 下一頁
  		if ( pageNum >= pdfDoc.numPages ) {
  			return;
  		}
  		pageNum++;
  		queueRenderPage( pageNum );
  	}
  	document.getElementById( "next" ).addEventListener( "click", onNextPage );
/*
  	pdfjsLib.getDocument( url ).then( function( pdfDoc_ ) {
  		pdfDoc = pdfDoc_;
  		document.getElementById( "page_count" ).textContent = pdfDoc.numPages;
  		renderPage( pageNum );
  	});

*/

///  
  const loadingTask = pdfjsLib.getDocument(url);
  (async () => {
     pdfDoc = await loadingTask.promise;
    //
    // Fetch the first page
    //
    document.getElementById( "page_count" ).textContent =await pdfDoc.numPages;
	
    page = await pdfDoc.getPage(1);
    
    
    viewport = page.getViewport({ scale });
    // Support HiDPI-screens.
    

    //
    // Prepare canvas using PDF page dimensions
    //
    
    

    canvas.width = Math.floor(viewport.width * outputScale);
    canvas.height = Math.floor(viewport.height * outputScale);
    canvas.style.width = Math.floor(viewport.width) + "px";
    canvas.style.height = Math.floor(viewport.height) + "px";

     transform = outputScale !== 1 
      ? [outputScale, 0, 0, outputScale, 0, 0] 
      : null;

    //
    // Render PDF page into canvas context
    //
    const renderContext = {
      canvasContext: context,
      transform,
      viewport,
    };
    page.render(renderContext);
  })();
</script>
<!--
<hr>
<h2>JavaScript code:</h2>  -->
<pre id="code"></pre>
<script>
  document.getElementById('code').textContent1 =
      document.getElementById('script').text;
</script>
</body>
</html>
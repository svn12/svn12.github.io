<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	 <!-- 
	Reference Chart.js example 
		https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="js/JK_JS.js"></script>	
	-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	
    <title>Plot</title>

    <style> 
            .container {  display: flex;}
            </style>

</head>




<style type="text/css">
	 input,select{
            margin: 0px;
            display: inline;
            font-size: 18px;
        }

        /* label {display:inline;} */
        /* input {display:inline;} */
        button {
            font-size: 16px;
        }
	#fixed-div {
	  position: fixed;
	  top: 100;
	  left: 0;
	  right: 0;
	  overflow-x:auto;
	/*  height: 60px;*/
	 
	}
    table {
	  border-collapse: collapse;
	  border-spacing: 0;
	  width: 100%;
	  border: 1px solid #ddd;
	  overflow-x:scroll;
	  overflow-y:scroll;
	}

	th, td {
	  text-align: left;
	  padding: 8px;
	}

	tr:nth-child(even){
		/* background-color: #f2f2f2 
		overflow-y: scroll;
		display: block;
		*/
		 background-color: lightblue;
		}
	table thead {
        background-color: orange;
      }
</style>
<script>
$(document).ready(function() {
  var shtUrl='"https://docs.google.com/spreadsheets/d/1jx9hL4CZuyET00_6LYbcz4d23WLv7iMsLbcPR3xqGbo/edit?usp=sharing"'
 // GSname(shtUrl);
 // R_Url();
  
})

function RGsheet(){
	 
	document.getElementById("show").innerHTML = '讀取資料 ---- ' +document.getElementById("select_sh").value ;
	var $show = $('#show');
	var shURL= 'https://docs.google.com/spreadsheets/d/1yt3EfSIVBi-NOvoeqwEtp-DcnIODM9LK84alJLh9JJI/edit?usp=sharing';
	// console.log(shURL);
	var a = {
		sheetUrl:document.getElementById("select_url").value ,
		sheetTag: document.getElementById("select_sh").value  //'Test'
		};
	const RSheet2Json_API_link=	'https://script.google.com/macros/s/AKfycbzNfl10XRckFQjzyUrzeQXS_aJf7C39_V-k-UqKKuucjC0iEMJ5hkT0oCK-F-B-c10TcQ/exec'
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	const RSheet2Json_API='https://script.google.com/macros/s/AKfycbwsHjkAvTx37IrpVzf07FVVHmVz0HqRGQ-__ucipLl2o-_U1C2yH0t-5ADrCevDO4RFfg/exec';
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   
		var heads=[];
		for(head in data[0]){
			heads.push(data[0][head]);
		}
		// console.log(heads.length);

		var txt='';
		txt += '<table  class="table  table-hover "> <thead><tr>';
		// heads.forEach(el=>console.log(el));
		heads.forEach(function(e1){
		    
			if(e1.length>=20 && ((new Date(e1))!="Invalid Date")){
				txt += "<td>" + (new Date(e1)).toLocaleDateString() + "</td>";
			}else
			{
			txt += "<th align='center'>" + e1 + "</th>";
			}
		})
		
		txt+="</tr></thead><tbody>";
		// console.log(txt);

		for (x in data) {
			if(x!="0"){
			txt += "<tr>";
			// console.log(x);
			// console.log(data[x]);
			heads.forEach(function(item,e){
			if(data[x][e].length>=20 && ((new Date(data[x][e]))!="Invalid Date")){
				txt += "<td>" + (new Date(data[x][e])).toLocaleDateString() + "</td>";
				}
			else{
				
				txt += "<td>"+ data[x][e]+"</td>";
			     
				}
				
			})
			txt += "</tr>";
			}
		}
		txt += "</tbody></table>"
		document.getElementById("show").innerHTML = txt;


		var arr = [];
		for (var i = 0; i < (a.endRow - a.row + 1); i++) {
			arr[i] = d.splice(0, (a.endCol - a.col + 1));
			$show.append(arr[i] + '<br/>');
		}
		
	   });
	}
function Google_sht_R(){
	GSname(document.getElementById("select_url").value);
	document.getElementById("file_href").href =document.getElementById("select_url").value
	}	
function  GSname(shtUrl){
  
  var select_sh=$('#select_sh').val();
  var a = {
	sheetUrl:shtUrl
                    };
   $.get('https://script.google.com/macros/s/AKfycby2wc_EZaX2pcqBgCApZz5C2ZfYX09GNGJ6IFygOaxsTtYeBgnKmkpJqeNhAo8-A-pVnQ/exec', a, function (data) {
                $("#select_sh").empty();
                
                $('#select_sh').append($('<option>', { 
                      value: '',
                      text : `---請選擇---- ${$("#select_url option:selected").text()} `
                      }));
                       
                data = JSON.parse(data);
                $.each(data, function (i, item) {
                    $('#select_sh').append($('<option>', { 
                      value: item.Sname,
                      text : item.Sname 
                }));
				});
                   
                });
  
}
function  R_Url(){
  const fmain='https://docs.google.com/spreadsheets/d/1SoMEYJbCHBd3FDl8gjaiQMZ1WBCkDTazGHALGnKgMpk/edit#gid=2114459986';
  var a = {
		sheetUrl:fmain,
		sheetTag: 'Main' //'Test'
		};
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   
	//	console.log(data);
		$("#select_url").empty();
		
		$.each(data, function (i, item) {
			if(i!=0){
				$('#select_url').append($('<option>', { 
				  value: item[1],
				  text : item[0] 
				}));
			}
		});
		Google_sht_R();
		});

}
function Remove_iframe() {
  $("#plot").empty();
  let g = document.createElement('canvas');
  g.setAttribute("id", "myChart2");
  g.setAttribute("style","width:100%;max-width:90%;max-height:80%");
  document.getElementById("plot").appendChild(g)
 /* const element = document.getElementsByClassName("chartjs-hidden-iframe");
  if(element.length>0){
  element[0].remove();
  } */
}
function  Plot_JK資產(){
  const fmain='https://docs.google.com/spreadsheets/d/1yQ_lM1agwbTrCS0mSh2bVg_e0cPjLFQbqF7uFkY155A/edit?usp=sharing';
  var a = {
		sheetUrl:fmain,
		sheetTag: 'All' //'Test'
		};
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   const xlabel = [];
	   const data1=[];
	   
	   const data4=[];
	   const data3=[];
	   const data2=[];

	   $.each(data, function (i, item) {
			if(i!=0){
				xlabel.push((new Date(item[0])).toLocaleDateString());
				
				data1.push(item[16]);
				data2.push(item[1]);
				data3.push(item[2]);	
				data4.push(item[18]);	
				}
			}
		);
		
		Remove_iframe();
		new Chart(document.getElementById("myChart2"), {
		type: 'line',
		data: {
			labels: xlabel,
    datasets: [{ 
        data: data1,
        label: data[0][16],
        borderColor: "#e8c3b9",
        fill: false
      }, { 
        data: data2,
        label: data[0][1],
        borderColor: "#3e95cd",
        fill: false
      },{ 
        data: data3,
        label: data[0][2],
        borderColor: "#8e5ea2",
        fill: false
      },{ 
        data: data4,
        label: data[0][18],
        borderColor: "#c45850",
        fill: false
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: 'JK資產'
			}
			}
		}); 
		
		});
}
function  Plot_Sofie資產(){
  const fmain='https://docs.google.com/spreadsheets/d/1yQ_lM1agwbTrCS0mSh2bVg_e0cPjLFQbqF7uFkY155A/edit?usp=sharing';
  var a = {
		sheetUrl:fmain,
		sheetTag: 'Lan_Stock' //'Test'
		};
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   const xlabel = [];
	   const data1=[];
	   
	   const data4=[];
	   const data3=[];
	   const data2=[];

	   $.each(data, function (i, item) {
			if(i!=0){
				xlabel.push((new Date(item[0])).toLocaleDateString());
				
				data1.push(item[1]);
				data2.push(item[3]);
				data3.push(item[5]);	
				data4.push(item[7]);	
				}
			}
		);
		
		Remove_iframe();
		new Chart("myChart2", {
		type: 'line',
		data: {
			labels: xlabel,
    datasets: [{ 
        data: data1,
        label: data[0][1],
        borderColor: "#e8c3b9",
        fill: false
      }, { 
        data: data2,
        label: data[0][3],
        borderColor: "#3e95cd",
        fill: false
      },{ 
        data: data3,
        label: data[0][5],
        borderColor: "#8e5ea2",
        fill: false
      },{ 
        data: data4,
        label: data[0][7],
        borderColor: "#c45850",
        fill: false
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: '蘭股票'
			}
			}
		}); 
		
		});
}
function  Plot_JK股票(){
  const fmain='https://docs.google.com/spreadsheets/d/1yQ_lM1agwbTrCS0mSh2bVg_e0cPjLFQbqF7uFkY155A/edit?usp=sharing';
  var a = {
		sheetUrl:fmain,
		sheetTag: 'jk_stk' //'Test'
		};
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   const xlabel = [];
	   const data1=[];
	   
	  
	   const data3=[];
	   const data2=[];

	   $.each(data, function (i, item) {
			if(i>0){
				xlabel.push((new Date(item[0])).toLocaleDateString());
				
				data1.push(item[5]);
				data2.push(item[8]);
				data3.push(item[9]);	
				}
			}
		);
		
		Remove_iframe();
		new Chart("myChart2", {
		type: 'line',
		data: {
			labels: xlabel,
    datasets: [{ 
        data: data1,
        label: data[0][5],
        borderColor: "#e8c3b9",
        fill: false
      }, { 
        data: data2,
        label: data[0][8],
        borderColor: "#3e95cd",
        fill: false
      },{ 
        data: data3,
        label: data[0][9],
        borderColor: "#8e5ea2",
        fill: false
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: 'JK股票'
			}
			}
		}); 
		
		});
}
function  Plot_直播(){
  const fmain='https://docs.google.com/spreadsheets/d/1-ilHZPwGq_nGIHBLerb49LHqf-RsOqYiaCWryc7hhfw/edit?usp=sharing';
  var a = {
		sheetUrl:fmain,
		sheetTag: '表單回應 1' //'Test'
		};
	const RSheet2Json_APIV2='https://script.google.com/macros/s/AKfycbz64VaqfqXVBwcFfDgDfehn947foLoeEOD6WXsvu3BNcXK6ZgTxjQAbzsIqSWmptLAo/exec'
	$.get(RSheet2Json_APIV2, a, function (data) {    
	   const xlabel = [];
	   const data2=[];
	   
	   const data3=[]
	   

	   $.each(data, function (i, item) {
			if(i!=0){
				xlabel.push((new Date(item[1])).toLocaleDateString());
				data2.push(item[2]);
				if(item[3]==''){data3.push("");}
				else{
					data3.push(item[3]);
					}
				}
			}
		);
		
	//	console.log(data);
		//$("#select_url").empty();
		Remove_iframe();
		new Chart("myChart2", {
		type: 'line',
		data: {
			labels: xlabel,
    datasets: [{ 
        data: data2,
        label: data[0][2],
        borderColor: "#3e95cd",
        fill: false
      }, { 
        data: data3,
        label: data[0][3],
        borderColor: "#8e5ea2",
        fill: false
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: '直播禮拜人數'
			}
			}
		}); 
		
		});
}
	





</script>
<body>
<button type="button" onclick="Plot_直播()">直播紀錄</button>
<button type="button" onclick="Plot_JK資產()">JK資產</button>
<button type="button" onclick="Plot_JK股票()">JK股票</button>
<button type="button" onclick="Plot_Sofie資產()">蘭股票</button>


<div id="plot" > 

	

</div>


</body>
</html>

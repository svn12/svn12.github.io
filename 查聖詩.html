<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script> -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script> -->
    <title>查聖詩啟應文</title>
  
    <style> 
            .container {  max-width: 700px;}
            #parent {
        display:flex;
        
}
            </style>
</head>
<body >
    <div class="container">
    <div id="parent">
    <!-- <h2 >&nbsp&nbsp &nbsp聖詩與啟應文&nbsp&nbsp &nbsp</h2> -->
    <a href="https://svn12.github.io/%E6%9F%A5%E8%81%96%E8%A9%A9.html"><img width="80" height="80" src="https://chart.googleapis.com/chart?cht=qr&amp;chl=https%3A%2F%2Ftinyurl.com%2Fyzvshjn4&amp;chld=L|0&amp;chs=150" border="0"></a>
    <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="https://www.dropbox.com/sh/q6uxx8wsajjzt17/AAD7pxz5-Xmmu8BZbX2BgekDa?dl=0&fbclid=IwAR2fJdygOWikE3EqA5u9y2scv2-MK1e_MUI-D-hGkCCQwU0YOKdRw7uS2HU">新聖詩</a></h3>
    <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="https://www.dropbox.com/sh/co16udpz9hj9db2/AADnezX7loz1cvr6l75W9-Yka?dl=0">帶譜PPT</a></h3>
    <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="https://www.dropbox.com/sh/625wgq90om6vx2m/AABJNxt_kPhZnBJM_pO3-62Ya?dl=0&fbclid=IwAR2Q6aXAPtMepu7ckVk8ejFi8Y-liPadNvYDY9RM82VipsiXWSMwm5YEK4U">帶譜PPT2</a></h3>
     <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="https://www.dropbox.com/sh/8zmxs65lb0ui657/AAD-GV1mLcvnqliyVr_kovSja">啟應文</a></h3>
    <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="https://www.facebook.com/groups/1717506455171469/permalink/1874744572780989
">臉書源頭</a></h3>
    <h3>&nbsp&nbsp &nbsp</h3>
    <h3><a href="youtube/jk2_link_P.html">聽讀聖經</a></h3>
    <h3>&nbsp&nbsp &nbsp</h3>

</div>
    <br>
        
         聖詩001~650 啟應文01~66 &nbsp: <input type="text"  class="form-control" placeholder="歌名或首別關鍵字" id="location-input" />
   
    <select id='selectTle'>
        <option selected="selected" value="https://docs.google.com/spreadsheets/d/1yt3EfSIVBi-NOvoeqwEtp-DcnIODM9LK84alJLh9JJI/edit?usp=sharing">新聖詩</option>
        <option value="https://docs.google.com/spreadsheets/d/1q_UJy2TzT3Iy5WlPSMCp-JpYEj7Y3f6kT6fTacOn3vc/edit?usp=sharing">讚美詩網</option>
        <!-- <option value="UK">UK</option> -->
    </select>
   
    <!-- <input type="submit" value="查詢" /> -->
    <input id="btnClickMe" type="button" value="查詢" />
       
        <div class="table-responsive">
        <div id="show"></div>
         </div>
     </div>
    <script>
       
        $(document).ready(function () {
            
            $(':input').change(function () {
                //  alert(this.value);
                 qTel();
                })
            
            $('#btnClickMe').click(function () {
                // alert($(this).val()+ '  ---' + txtptr.val());
                 qTel();
            })
            
            function qTel(){
                var txtptr=$('input[type="text"]');
                var selectedTle= $('#selectTle option:selected');
                if(txtptr.val().length==0){
                    alert ('請輸入關鍵字再查詢');
                    return
                }
                else{
                    // alert (txtptr.val()+ ' option--' + selectedTle.text() +' --' + selectedTle.val());
                    Query_Tel2();
                }
                

            }
        });

          
         function        Query_Tel2(){
                // var txtptr=$('input[type="text"]');
                var selectedTle= $('#selectTle option:selected');

                var findString =$('input[type="text"]').val();
                // var findString = document.getElementById('location-input').value;
                // console.log(findString);
                if(findString.length>0){
                    
                if(findString=='!'){ findString = '';}
                document.getElementById("show").innerHTML = '查詢 "*' + findString+'*" 中 ....';
                var $show = $('#show');
                var shURL= selectedTle.val();
                var a = {
                    sheetUrl:shURL,
                    sheetTag: 'List',
                    findSting: findString
                    };
                    //https://script.google.com/macros/s/AKfycbyqALYgYmkOq61OVNBD5M0dcSWP0Ims1LD5CzwrGnF-tIxdTRdqFfDmzXHBCX9YbL5MMg/exec
                const Search_API='https://script.google.com/macros/s/AKfycbyqALYgYmkOq61OVNBD5M0dcSWP0Ims1LD5CzwrGnF-tIxdTRdqFfDmzXHBCX9YbL5MMg/exec';
                $.get(Search_API, a, function (data) {
                    if(data.length==2){
                        document.getElementById("show").innerHTML = '查無資料 請重新輸入再查詢';
                    }
                    else  if (data.length==0){ 
                        document.getElementById("show").innerHTML = 'sheet Name 須為 "List"';}
                    else {

                    // console.log(data.length);
                    // console.log(data);
                    data = JSON.parse(data);
                    var heads=[];
                    for(head in data[0]){
                        heads.push(head);
                    }
                    // console.log(heads.length);

   
                    var txt='';
                    // txt += '<table  class="table  table-hover "> <thead><tr>';
                     txt += '<table  class="table"> <thead><tr>';
                    // heads.forEach(el=>console.log(el));
                    heads.forEach(function(e){
                        txt += "<th>" + e + "</th>";

                    })
                    
                    txt+="</tr></thead><tbody>";
                    // console.log(txt);

                    for (x in data) {
                        // console.log(x);
                        // console.log(data[x][heads[0]]);
                        if(data[x][heads[0]].indexOf(findString)>=0){
                            txt += "<tr>";
                             
                            //  console.log(data[x]);
                            heads.forEach(function(e){
                                if(e==heads[0]){
                                    txt += "<td>" + data[x][e] + "</td>";
                                } 
    

                                else {
                                    if(data[x][e]!="")
                                        txt +='<td><a href="' + data[x][e] + '">連結</a></td>';
                                }
                            })
                            txt += "</tr>";
                        }
                        // txt += "<tr><td>" + data[x].Name + "</td><td>"+ data[x].手機 +"</td></tr>";
                    }
                    txt += "</tbody></table>"
                    document.getElementById("show").innerHTML = txt;


                    var arr = [];
                    for (var i = 0; i < (a.endRow - a.row + 1); i++) {
                        arr[i] = d.splice(0, (a.endCol - a.col + 1));
                        $show.append(arr[i] + '<br/>');
                    }
                    }

                });
            };
        }
    </script>
</body>
</html>